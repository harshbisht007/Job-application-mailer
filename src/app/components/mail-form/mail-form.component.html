<p-toast></p-toast>
<p-card styleClass="shadow-lg rounded-2xl border border-surface-200/50">
  <ng-template pTemplate="header">
    <div class="flex items-start justify-between gap-3">
      <div class="flex items-center gap-2">
        <i class="pi pi-send text-primary text-xl"></i>
        <div class="leading-tight">
          <div class="font-semibold">Resume Mailer</div>
          <div class="text-xs text-muted-color">Paste recipients, attach resume, and send</div>
        </div>
      </div>
    </div>
  </ng-template>

  <form [formGroup]="form" class="space-y-4">
    <div class="flex flex-col gap-2">
      <label class="font-medium">Recipients</label>
      <div class="flex flex-col md:flex-row gap-2">
        <textarea class="flex-1" pInputTextarea formControlName="recipientsPaste" rows="3" placeholder="Paste emails separated by comma or new lines"></textarea>
        <div class="flex items-start gap-2 md:w-40">
          <button pButton type="button" severity="success" size="small" icon="pi pi-list-check" label="Parse" (click)="parsePastedRecipients()"></button>
        </div>
      </div>
      <div class="text-xs text-muted-color">Parsed: {{ (form.get('recipients')?.value || []).length }} recipient(s)</div>
      <div class="chips-box mt-1">
        <p-chip *ngFor="let e of form.get('recipients')?.value; let i = index" [label]="e" [removable]="true" (onRemove)="removeRecipient(i)"></p-chip>
      </div>
      <div class="text-sm text-red-600" *ngIf="form.get('recipients')?.touched && form.get('recipients')?.invalid">
        <span *ngIf="form.get('recipients')?.errors?.['emailRequired']">At least one email is required.</span>
        <span *ngIf="form.get('recipients')?.errors?.['invalidEmails']">One or more emails are invalid.</span>
      </div>
    </div>

    <div class="flex flex-col gap-2 section">
      <label class="font-medium">Subject</label>
      <input pInputText formControlName="subject" placeholder="Subject" />
      <div class="text-sm text-red-600" *ngIf="form.get('subject')?.touched && form.get('subject')?.invalid">
        Subject is required.
      </div>
    </div>

    <div class="flex flex-col gap-2 section">
      <label class="font-medium">Message</label>
      <textarea pInputTextarea formControlName="message" rows="6" placeholder="Write your message..."></textarea>
      <div class="text-sm text-red-600" *ngIf="form.get('message')?.touched && form.get('message')?.invalid">
        Message is required.
      </div>
      <div class="hint text-xs">
        You can use tokens: {{'{{role}}'}}, {{'{{experience}}'}}, {{'{{email}}'}}
      </div>
    </div>

    <div class="flex flex-col gap-2 section">
      <label class="font-medium">Resume (PDF/DOCX)</label>
      <p-fileUpload
        mode="basic"
        name="file"
        customUpload="true"
        (onSelect)="onFileSelect($event)"
        (onClear)="removeFile()"
        [auto]="false"
        chooseLabel="Choose File"
        [multiple]="false"
        accept=".pdf,.doc,.docx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/msword"
      ></p-fileUpload>
      <div class="text-sm text-muted-color" *ngIf="selectedFile">Selected: {{ selectedFile?.name }}</div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 section">
      <div class="flex flex-col gap-2">
        <label class="font-medium">Role</label>
        <input pInputText formControlName="role" placeholder="e.g., Angular Developer" />
      </div>
      <div class="flex flex-col gap-2">
        <label class="font-medium">Experience (years)</label>
        <input pInputText type="number" step="0.1" formControlName="experienceYears" />
      </div>
      <div class="flex items-end gap-2">
        <p-toggleswitch formControlName="sendIndividually"></p-toggleswitch>
        <span class="text-sm">Send individually</span>
      </div>
    </div>

    <div class="pt-2">
      <button pButton type="button" label="Send" icon="pi pi-send" severity="success" [disabled]="uploading()" (click)="submit()" class="w-full md:w-auto"></button>
    </div>
  </form>
</p-card>


